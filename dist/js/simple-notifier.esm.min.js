function t(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const e=require("merge-options");import{getPropValue as s,motionAllowed as i,timeToMs as n}from"@codebundlesbyvik/css-operations";import o from"@codebundlesbyvik/element-operations";import a from"@codebundlesbyvik/number-operations";const h={autoHide:!0,onlyOneNotification:!0,parentEl:document.body,position:"top center",animations:"auto"};class d{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.mergedOptions=e(h,t),this.autoHide=this.mergedOptions.autoHide,this.parentEl=this.mergedOptions.parentEl,this.position=this.mergedOptions.position,this.motionPref=this.mergedOptions.animations,this.instanceId=null,this.nId=1,this.nodes={},this.msgData={},this.timeoutIds={},this.events={},this.onlyOne={set:this.mergedOptions.onlyOneNotification,states:{},nextMsgData:{}},this.animatedRun=null}get animated(){switch(this.motionPref){case"undefined":case"auto":return i();default:return this.motionPref}}get hideCallTimeout(){switch(this.autoHide){case!0:return 3500;case!1:return 0;default:return this.autoHide}}init(){if(this.instanceId)throw new Error("SN: .init() has already been called on this instance (".concat(this.instanceId,")."));this.instanceId=a(1e5),this.nodes.wrapper=o(d.nodeSkeletons.wrapper.tagName,d.nodeSkeletons.wrapper.attrs),this.nodes.wrapper.dataset.instanceId=this.instanceId;const t=this.parentEl.firstElementChild,e=t.classList.contains("simple-notifier")?t.nextElementSibling:t;this.parentEl.insertBefore(this.nodes.wrapper,e);const s=this.position.split(" ");1===s.length&&(s[1]="center"),this.nodes.wrapper.classList.add("".concat(d.nodeClasses.wrapper,"--pos-y-").concat(s[0]),"".concat(d.nodeClasses.wrapper,"--pos-x-").concat(s[1])),this.events.allDestroyed=new CustomEvent("allNotificationsDestroyed",{detail:{instanceId:this.instanceId}})}destroy(){if(!this.instanceId)throw new Error("SN: Instance isn't initialized!");this.runningDestroy||(this.runningDestroy=!0,this.nodes.wrapper.addEventListener("allNotificationsDestroyed",(t=>{this.nodes.wrapper.remove(),this.onlyOne&&(this.onlyOne.states={},this.onlyOne.nextMsgData={}),this.events={},this.nId=1,this.instanceId=null,delete this.runningDestroy})),this.hide())}show(t,e){if(!this.instanceId)throw new Error("SN: Instance isn't initialized!");if(this.onlyOne.set){if(this.onlyOne.states.inReshow)return;if(this.onlyOne.states.isVisible)return void this._reshowNotification(t,e)}let s=this.nId;this.onlyOne.set||this.nId++,this._initNotification(s),this._getMsgData(s,t,e),this._showNewNotification(s)}_initNotification(t){this.nodes[t]={};for(const[e,s]of Object.entries(d.nodeSkeletons))"wrapper"!==e&&(this.nodes[t][e]=o(s.tagName,s.attrs),"notification"===e?this.nodes.wrapper.insertBefore(this.nodes[t][e],this.nodes.wrapper.firstElementChild):this.nodes[t].notification.append(this.nodes[t][e]));this.nodes[t].notification.dataset.notificationId=t,this.timeoutIds[t]={},this.events[t]={},this.events[t].shown=new CustomEvent("notificationShown",{detail:{instanceId:this.instanceId,notificationId:t}}),this.events[t].destroyed=new CustomEvent("notificationDestroyed",{detail:{instanceId:this.instanceId,notificationId:t}}),this.nodes.wrapper.addEventListener("notificationShown",this.events[t].shown,{once:!0}),this.nodes.wrapper.addEventListener("notificationDestroyed",this.events[t].destroyed,{once:!0})}_getMsgData(t,e,s){t&&(e||(this.onlyOne.nextMsgData?(e=this.onlyOne.nextMsgData.text,s=this.onlyOne.nextMsgData.type,this.onlyOne.nextMsgData={}):(e=d.defaultMsgData.notext.text,s=d.defaultMsgData.notext.type)),s||(s=d.defaultMsgData.notype.type),this.msgData[t]={},this.msgData[t].text=e,this.msgData[t].type=s)}_showNewNotification(t){if(this.animatedRun=this.animated,this.nodes[t].message.textContent=this.msgData[t].text,this.nodes[t].notification.classList.add("".concat(d.nodeClasses.notification,"--").concat(this.msgData[t].type),d.nodeClasses.shown),this.animatedRun){this.nodes[t].notification.classList.add(d.nodeClasses.anim.base,d.nodeClasses.anim.show);const e=n(s(this.nodes[t].notification,"animation-duration"));this.timeoutIds[t].showAnim=setTimeout((()=>{this.nodes[t].notification.classList.remove(d.nodeClasses.anim.show)}),e)}this.onlyOne.set&&(this.onlyOne.states.isVisible=!0),this.nodes.wrapper.dispatchEvent(this.events[t].shown),this.hideCallTimeout>0?this.timeoutIds[t].hideCall=setTimeout((()=>{this.hide(t)}),this.hideCallTimeout):this.animatedRun=null}_reshowNotification(t,e){this.onlyOne.states.inReshow=!0,this.onlyOne.nextMsgData.text=t,this.onlyOne.nextMsgData.type=e,clearTimeout(this.timeoutIds[1].hideCall),this.hide(1)}hide(t){if(!this.instanceId)throw new Error("SN: Instance isn't initialized!");if(this.onlyOne.set){if(this.onlyOne.states.inHide)return;this.onlyOne.states.inHide=!0}let e;if("number"==typeof t){if("undefined"===this.msgData[t])return;e=[t]}if(void 0===t)if(e=Object.keys(this.msgData),e.length>0)Object.values(this.timeoutIds).forEach((t=>{Object.values(t).forEach((t=>{clearTimeout(t)}))}));else{if(!this.runningDestroy)return void(this.onlyOne.set&&(this.onlyOne.states.inHide=!1));this.nodes.wrapper.dispatchEvent(this.events.allDestroyed)}e.forEach((t=>{this._hideNotification(t)})),this.onlyOne.set&&(this.onlyOne.states.inHide=!1)}_hideNotification(t){null===this.animatedRun&&(this.animatedRun=this.animated);let e=0;this.animatedRun&&(this.nodes[t].notification.classList.add(d.nodeClasses.anim.hide),e=n(s(this.nodes[t].notification,"animation-duration"))),this.timeoutIds[t].hideAnim=setTimeout((()=>{this.nodes[t].notification.classList.remove(d.nodeClasses.shown),this.nodes[t].notification.className=this.nodes[t].notification.className.replace(d.nodeClasses.typeRegex,""),this.animatedRun&&this.nodes[t].notification.classList.remove(d.nodeClasses.anim.hide),this.onlyOne.set&&(this.onlyOne.states.isVisible=!1),this._destroyNotification(t)}),e)}_destroyNotification(t){const e=Object.keys(this.nodes[t]),s=Object.values(this.nodes[t]);new Promise((t=>{let i=0;s.forEach((s=>{s.remove(),i++,i===e.length&&t("All nodes have succesfully been removed.")}))})).then((()=>{this.animatedRun=null,delete this.nodes[t],delete this.msgData[t],delete this.timeoutIds[t],this.nodes.wrapper.dispatchEvent(this.events[t].destroyed),delete this.events[t],0===Object.keys(this.msgData).length&&this.nodes.wrapper.dispatchEvent(this.events.allDestroyed),this.onlyOne.set&&this.onlyOne.states.inReshow&&(this.onlyOne.states.inReshow=!1,this.show())})).catch((t=>{throw new Error(t)}))}}t(d,"nodeClasses",{wrapper:"simple-notifier",notification:"simple-notification",typeRegex:/simple-notification--[A-Za-z]+/g,shown:"is-shown",anim:{base:"animated",show:"fadeIn",hide:"fadeOut"}}),t(d,"nodeSkeletons",{wrapper:{tagName:"div",attrs:{class:d.nodeClasses.wrapper}},notification:{tagName:"div",attrs:{class:d.nodeClasses.notification,role:"alert"}},message:{tagName:"p",attrs:{class:"".concat(d.nodeClasses.notification,"__message")}}}),t(d,"defaultMsgData",{notext:{text:"This is some dummy text for you, because none was passed in.",type:"debug"},notype:{type:"default"}});export default d;
//# sourceMappingURL=simple-notifier.esm.min.js.map